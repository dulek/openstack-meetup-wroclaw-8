<!DOCTYPE html>
<html>
  <head>
    <title>OpenStack WrocÅ‚aw Meetup #8 - mini kurs</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="slides.css"></link>
  </head>
  <body>
    <textarea id="source">

layout: true
name: title_layout
class: title_slide

---

layout: true
name: section_layout
class: section_slide

---

layout: true
name: agenda_layout
class: content_slide agenda_slide

---

layout: true
name: thank_you
class: thank_you

---

layout: true
name: content_layout
class: content_slide

---

template: title_layout

# OpenStack WrocÅ‚aw Meetup #8

## Mini kurs dla uÅ¼ytkownikÃ³w

MichaÅ‚ Dulko - Software Engineer - Red Hat<br>
<br>
31 stycznia 2018<br>

---

template: agenda_layout

# AGENDA

**https://dulek.github.io/openstack-meetup-wroclaw-8**

1. WTF is OpenStack?
2. Sposoby komunikacji i interakcji z OpenStackiem
3. "Wyklikanie" VM-ki w Horizon
4. Command Line Interface (python-openstackclient)
5. Inne przydatne czynnoÅ›ci

---

template: section_layout

Wprowadzenie

---

# WTF is OpenStack?

## Definicja

OpenStack - oprogramowanie z dziedziny chmur obliczeniowych w modelu
Infrastructure as a Service (IaaS) rozwijane przez Rackspace Cloud oraz NASA.
WÅ›rÃ³d 150 firm rozwijajÄ…cych technologiÄ™ OpenStack sÄ… m.in.: AMD, Avaya, Intel,
Canonical, Novell, Cisco, Dell, IBM, HP, Fujistu.  OpenStack posiada API zgodne
z Amazon EC2.

---

# WTF is OpenStack?

## Definicja

~~OpenStack - oprogramowanie z dziedziny chmur obliczeniowych w modelu
Infrastructure as a Service (IaaS) rozwijane przez Rackspace Cloud oraz NASA.
WÅ›rÃ³d 150 firm rozwijajÄ…cych technologiÄ™ OpenStack sÄ… m.in.: AMD, Avaya, Intel,
Canonical, Novell, Cisco, Dell, IBM, HP, Fujistu.  OpenStack posiada API zgodne
z Amazon EC2.~~

--

OpenStack is a free and open-source software platform for cloud computing,
mostly deployed as infrastructure-as-a-service (IaaS), whereby virtual servers
and other resources are made available to customers. The software platform
consists of interrelated components that control diverse, multi-vendor hardware
pools of processing, storage, and networking resources throughout a data
center. Users either manage it through a web-based dashboard, through
command-line tools, or through RESTful web services.

---

# WTF is OpenStack?

## Komponenty

- Keystone - identity - users, projects, tokens
- Nova - compute - VMs
- Neutron - networking - networks, subnets, IPs
- Glance - images - OS images
- Cinder - block storage - volumes
- Swift - object storage - objects
- Ironic - bare metal - servers

--

â€¦i maaasa innych (ponad 50 aktywnych), np. Designate (DNS), Magnum (kontenery),
Manila (filesystem storage), Octavia (LBaaS), Heat (orchestration)â€¦

---

# WTF is OpenStack?

## Sposoby komunikacji

- REST API
  - kaÅ¼dy projekt ma wÅ‚asne
    - Keystone catalog mÃ³wi gdzie szukaÄ‡ danego API.
  - stabline, wersjonowane
  - zdarzajÄ… siÄ™ niespÃ³jnoÅ›ci pomiÄ™dzy projektami
- **Horizon**
  - Web UI
- python-\*client (np. python-novaclient, python-neutronclient)
  - per-project CLIs
  - niespÃ³jne
- **python-openstackclient**
  - global CLI
  - nie wszystkie najnowsze funkcje obsÅ‚ugiwane

---

template: section_layout

Wprowadzenie

---


# Horizon

## DostÄ™p: **https://horizon.cloud.ovh.net**

.fill-width[![Insert graphic here](assets/screenshots/horizon-basic.png)]

---

# Horizon (a wÅ‚aÅ›ciwie Keystone)

## users, projects (tenants), domains, roles

- **User** - uÅ¼ytkownik, moÅ¼e naleÅ¼eÄ‡ do jednego i wiÄ™cej projektÃ³w
  - np. Stefan - administrator aplikacji XYZ, Zenon - administrator aplikacji ABC
- **Project (tenant)** - grupuje i izoluje zasoby chmury
  - np. JanuszCorp, firma posiadajÄ…ca aplikacje XYZ i ABC
- **Domain** - grupuje uÅ¼ytkownikÃ³w i projekty dla Å‚atwego zarzÄ…dzania uprawnieniami
  - np. klienci i projekty zewnÄ™trzne chmury PolCloudex, projekty wewnÄ™trzne PolCloudex
- **Role** - zestaw uprawnieÅ„ danego uÅ¼ytkownika w danym projekcie.

---

# Horizon (a wÅ‚aÅ›ciwie Keystone i Nova)

## regions, availability zones

.left-column[
- **Region** - oddzielny service catalog = oddzielny zestaw endpointÃ³w = oddzielne instancje service'Ã³w, czyli w praktyce oddzielna chmura.
- **Availability zone** - grupowania hostÃ³w wewnÄ…trz chmury, zarzÄ…dzane przez
  administratora chmury, zwykle toÅ¼same z failure domains.
]

.right-column[
![Insert graphic here](assets/screenshots/horizon-regions.png)
]

---

# Horizon

## Quotas

.fill-width[![Insert graphic here](assets/screenshots/horizon-quotas.png)]

---

# Horizon (znowu raczej Keystone)

## API access

.fill-width[![Insert graphic here](assets/screenshots/horizon-api.png)]

---

# Horizon

## Uruchamiamy VM-kÄ™ (instancjÄ™)

- Project â†’ Compute â†’ Instances
- Launch Instance
  - Details - podstawy
     - Name - *dowolna nazwa*
  - Source - z czego uruchomiÄ‡ maszynÄ™
     - Select Boot Source: *Image (z obrazu OS-a)*
     - Create new volume: *No*
     - Available: *Ubuntu 16.04*
  - Flavor - jakie parametry ma mieÄ‡ maszyna - RAM, dysk(i), iloÅ›Ä‡ VCPU
     - Available: *r2-15*
  - Networks - do jakich sieci byÄ‡ wpiÄ™ta maszyna
     - Ext-Net jest juÅ¼ wybrana
  - Ports - do jakich portÃ³w sieciowych ma byÄ‡ wpiÄ™ta maszyna

---

# Horizon

## Uruchamiamy VM-kÄ™ (instancjÄ™)

- Launch Instance
  - Security Groups - co VM-ka ma mieÄ‡ otwarte na firewallu
     - Default jest juÅ¼ wybrana
  - Key Pair - za pomocÄ… jakiego klucza bÄ™dziemy siÄ™ logowaÄ‡ do VM-ki
     - Create Key Pair
        - Name: *dowolna nazwa*
        - Create Keypair
        - **ZAPISZCIE KLUCZ W PLIKU NA DYSKU!**
   - Configuration - cloud init script (https://cloud-init.io/)
   - PozostaÅ‚e pominiemy.
  - **Launch Instance!**
  - Czekamy aÅ¼ VM-ka przejdzie w stan *ACTIVE*.

---

# Horizon (SSH)

## Logujemy siÄ™ do VM-ki

- RzuÄ‡my okiem na Security Groups (Network â†’ Security Groups â†’ default â†’ Manage Rules).
- IP znajdziemy w kolumnie IP Address na liÅ›cie instancji.

  ![Insert graphic here](assets/screenshots/horizon-ip.png)

- Wykonujemy w konsoli (zapisany klucz w ~/.ssh/ovh):

  ```bash
  $ ssh -i ~/.ssh/ovh ubuntu@$IP
  ```

- â€¦i powinniÅ›my zalogowaÄ‡ siÄ™ do konsoli naszej VM-ki!

---

template: section_layout

Command Line Interface

---

# OpenStack-Client

## Jumpbox VM

- Zawiera python-openstackclient, plik openrc

- IP: **213.251.131.44**
- konta dla uczestnikow
  - user1:user1
  - â€¦
  - user30:user30

Logowanie przez:

```bash
ssh user1@213.251.131.44
```

---
# OpenStack-Client

## Dane logowania

- Dane logowania do chmury znajdujÄ… siÄ™ w pliku **OpenStack RC**. MoÅ¼na go pobraÄ‡ z
  Horizona (Identity â†’ API Access â†’ Download OpenStack RC File â†’ OpenStack RC
  File (â€¦)).
- Zawiera on zmienne systemowe, ktÃ³rych klienty OpenStacka uÅ¼yjÄ… do logowania,
  m.in. URL do Keystone'a, uÅ¼ytkownika, hasÅ‚o, projekt, region.
- Alternatywnym formatem jest clouds.yaml, ale dziaÅ‚a tylko z python-openstackclient.

```bash
mdulko:openrcs/ $ source ovh
mdulko:openrcs/ $ env | grep OS_
OS_AUTH_URL=https://auth.cloud.ovh.net/v2.0/
OS_TENANT_ID=dff393b1184a4421acd532971855ce6b
OS_TENANT_NAME=1746933863448415
OS_USERNAME=FOOOBAR
OS_PASSWORD=FOOOOOBAAAAAARBAAAAZ
OS_REGION_NAME=WAW1
```

---

# OpenStack-Client

## Podstawy

OSC ma staÅ‚Ä… strukturÄ™ poleceÅ„:

```bash
$ openstack <rzeczownik> <czasownik> <parametry>
$ openstack server list
$ openstack volume create --size 10 nazwa_wolumenu
$ openstack security group list
```

OSC ma tryb "staÅ‚y":

```bash
$ openstack
(openstack) server list
<odpowiedÅº>
(openstack) network list
```

---

# OpenStack-Client

## Podstawy

OSC ma przydatnÄ… pomoc:

```bash
$ openstack help user create
usage: openstack user create [-h] [-f {json,bash,table,value,yaml}]
                             [-c COLUMN] [--max-width <integer>] [--fit-width]
                             [--print-empty] [--noindent] [--prefix PREFIX]
                             [--project <project>] [--password <password>]
                             [--password-prompt] [--email <email-address>]
                             [--enable | --disable] [--or-show]
                             <name>
```

---

# OpenStack-Client

## Tworzenie wolumenu z obrazu

```bash
openstack image list
openstack volume create --size 5 \
          --image 00ca8728-bb95-44d5-820e-69725c8a6450 ubuntu-volume
openstack volume list
openstack volume show 07d287e9-f4e7-4114-b2d8-ebb094ff80e0
```

---

# OpenStack-Client

## Bootowanie VM-ki z wolumenu

```bash
openstack flavor list
openstack network list
openstack keypair list
openstack server create --flavor r2-15 \
          --volume 07d287e9-f4e7-4114-b2d8-ebb094ff80e0 \
          --network 6c928965-47ea-463f-acc8-6d4a152e9745 \
          --key-name TEST3 ubuntu-vm
openstack server list
```

---

# OpenStack-Client

## SSH i instalacja Apache'a

```bash
ssh -i ~/.ssh/ovh ubuntu@145.239.29.153
sudo apt install apache2
```

I teraz po wejÅ›ciu na podane IP powinniÅ›cie zobaczyÄ‡ stronÄ™ startowÄ… Apache'a. :)

---

# OpenStack-Client

## Migawka wolumenu

```bash
openstack volume list
openstack volume snapshot create --force \
          --volume 07d287e9-f4e7-4114-b2d8-ebb094ff80e0 ubuntu-snapshot
```

---

# OpenStack-Client

## VM z migawki wolumenu

```bash
openstack volume create --snapshot ubuntu-snapshot ubuntu-volume2
openstack server create --flavor r2-15 \
          --volume c189f92f-4b0b-486a-baf9-de33d7b38bbf \
          --network 6c928965-47ea-463f-acc8-6d4a152e9745 \
          --key-name TEST3 ubuntu-vm2
```

---

# OpenStack-Client

## Nagrywanie wolumenu do obrazu

```bash
openstack server delete ubuntu-vm2
cinder image-create --force \
       --container-format bare \ 
       --disk-format qcow2 \
       --volume c189f92f-4b0b-486a-baf9-de33d7b38bbf ubuntu-with-apache
```

MoÅ¼na teÅ¼ zrobiÄ‡ snapshot instancji bezpoÅ›rednio:

```bash
openstack server image create --name ubuntu-with-apache ubuntu-vm
```

---

template: section_layout

Inne czynnoÅ›ci

---

# Wgrywanie wÅ‚asnego obrazu

## Czyli - a jakbym chciaÅ‚ inny OS?

```bash
openstack image create --container-format bare \
          --disk-format qcow2 --file <plik> <nazwa>
openstack image list
openstack image show <nazwa>
```

---

# Operacje na VM-kach

## O co tu w ogÃ³le chodzi?

- **Soft/Hard Reboot** - twardy/miÄ™kki restart
- **Pause** - zaprzestanie dawanie VM-ce cyklÃ³w procesora.
- **Suspend** - hibernacja.
- **Resume** - odpauzowanie/odhibernowanie.
- **Shut off** - wyÅ‚Ä…czenie VM-ki.
- **Start** - bootowanie VM-ki.
- **Lock/Unlock** - zablokowanie czynnoÅ›ci na VM-ce.
- **Shelve/Unshelve** - zaznacz jako niepotrzebny, moÅ¼e zostaÄ‡ wtedy wyÅ‚Ä…czony.
- **Rebuild** - usuwa dane i bootuje VM-kÄ™ ze Å›wieÅ¼ego image'u. Id i IP zostajÄ…
  takie same.
- **Resize** - zmienia flavor (restartuje VM-kÄ™), trzeba potwierdziÄ‡ (Resize
  Confirm/Revert).
- **Cold Migrate** - (tylko admin), przenosi VM-kÄ™ na innego hosta wyÅ‚Ä…czajÄ…c
  jÄ….
- **Live Migrate** - (tylko admin), przenosi VM-kÄ™ na innego hosta "na Å¼ywo".

---

# Security Groups

## Czyli - czemu nie mogÄ™ zrobiÄ‡ SSH do VM-ki?

```bash
openstack security group list
openstack security group create icmp-only
openstack server add security group ubuntu-vm icmp-only
# ping dziaÅ‚a
openstack server remove security group ubuntu-vm default
# ping nie dziaÅ‚a
openstack security group rule create --protocol icmp icmp-only
# ping dziaÅ‚a, ale nie SSH
openstack server add security group default
openstack server remove security group icmp-only
# wszystko znowu dziaÅ‚a
```

---

# Fixed vs Floating IP

W OpenStacku VM moÅ¼e mieÄ‡ dwa rodzaje IP:

- **Fixed IP**
  - Klasyczne IP przydzielone z podsieci, do ktÃ³rej wpiÄ™ta jest VM-ka.
  - Zwykle uÅ¼ywane do Å‚Ä…czenia VM-ek do sieci lokalnych ("chmurowych").
  - W OVH Ext-Net przydziela IP publiczne.
- **Floating IP**
  - De-facto "alias" na port na VM-ce, VM nie wie, Å¼e jest dostÄ™pna
    pod danym adresem, przekierowanie zaÅ‚atwione manipulacjÄ… pakietami.
  - Wymaga "rezerwowania" z dostÄ™pnej dla projektu puli (quoty!) i rÄ™cznego
    "podÅ‚Ä…czenia" do VM-k.
  - Zwykle uÅ¼ywane do zapewniania VM-kom zewnÄ™trznych IP.
  - W OVH nie uÅ¼ywane.

---

# PodÅ‚Ä…czanie wolumenÃ³w

## Czyli - przenosimy dane w niepraktyczny sposÃ³b

```bash
openstack volume create --size 1 volume
openstack server add volume ubuntu-vm volume
ssh -i ~/.ssh/ovh ubuntu@<ip>

# Na VM-ce:
sudo su
fdisk -l
mkfs.ext4 /dev/sdb
mkdir -p /mnt/volume
mount /dev/sdb /mnt/volume
touch foobar
exit

# Poza VM-kÄ…
openstack server remove volume ubuntu-vm volume
```

---
# PodÅ‚Ä…czanie wolumenÃ³w

## Czyli - przenosimy dane w niepraktyczny sposÃ³b

```bash
openstack server add volume ubuntu-vm2 volume
ssh -i ~/.ssh/ovh ubuntu@<ip2>

# Na VM-ce:
sudo su
fdisk -l
mkdir -p /mnt/volume
mount /dev/sdb /mnt/volume
ls -la
exit
```

---

# Cloud init

## Czyli - jak zrobiÄ‡, Å¼eby nie mieÄ‡ tych gÅ‚upich kluczy?

Do pliku cloud-init.yaml wpiszcie:
```yaml
# cloud-config
hostname: rh-and-ovh-rules
```

I uruchomcie VM-kÄ™ z parametrem:
```bash
openstack server create --image <image-id> --network <network-id> \
          --flavor r2-15 --user-data cloud-init.yaml <nazwa>
```

--

```bash
ssh -i ~/.ssh/ovh ubuntu@<ip>
ubuntu@rh-and-ovh-rules:~$
```

---

template: thank_you

# DZIÄ˜KI!

**PrezentacjÄ™ moÅ¼na znaleÅºÄ‡ na:**

- https://dulek.github.io/openstack-meetup-wroclaw-8
- https://github.com/dulek/openstack-meetup-wroclaw-8

**MichaÅ‚ Dulko**

![email](assets/email.png)   [mdulko@redhat.com](mailto:mdulko@redhat.com)
![irc](assets/irc.png)   [dulek (freenode)](irc://chat.freenode.net/dulek,isnick)

---

template: section_layout

![CC](assets/cc.svg)
.medium-text[
Prezentacja jest udostÄ™pniana na licencji

http://creativecommons.org/licenses/by/4.0/
]

    </textarea>
    <script src="remark.js" type="text/javascript"></script>
    <script type="text/javascript">
      var slideshow = remark.create({
        ratio: '16:9',
        slideNumberFormat: '%current%   <span class="designator"> Mini-kurs OpenStacka Â· StyczeÅ„ 2018 Â· WrocÅ‚aw</span>',
        countIncrementalSlides: false
      });
    </script>
  </body>
</html>

<!-- vim: set ft=markdown : -->
